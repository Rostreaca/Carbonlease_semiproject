<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.campaign.model.dao.CampaignMapper">
	
	
	<sql id="campaignColumn">
      SELECT
	         P.CAMPAIGN_NO
	       , P.CAMPAIGN_TITLE
	       , P.CAMPAIGN_CONTENT
	       , P.START_DATE
	       , P.END_DATE
	       , A.FILE_PATH
	       , A.CHANGE_NAME
	       , A.FILE_LEVEL
	       , C.CATEGORY_NO
	       , C.CATEGORY_NAME
	       , (SELECT COUNT(*) FROM CL_CAMPAIGN_LIKE L WHERE L.CAMPAIGN_NO = P.CAMPAIGN_NO) AS LIKE_COUNT
	       , (SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
	            FROM CL_CAMPAIGN_LIKE L
	           WHERE L.CAMPAIGN_NO = P.CAMPAIGN_NO
	             AND L.MEMBER_NO = #{memberNo}) AS IS_LIKED
		FROM 
		     CL_CAMPAIGN P
		JOIN 
		     CL_CAMPAIGN_CATEGORY C ON P.CATEGORY_NO = C.CATEGORY_NO
		LEFT 
		JOIN 
		     CL_CAMPAIGN_ATTACHMENT A ON P.CAMPAIGN_NO = A.REF_BNO
	</sql>

	
	
	<!-- 전체조회 -->
	<select id="selectCampaignList" resultType="CampaignDTO">
	    <include refid="campaignColumn"/>
	    WHERE 
	          A.FILE_LEVEL = 0
	      AND 
	          P.STATUS = 'Y'
	      AND 
	          P.END_DATE >= SYSDATE
	    ORDER 
	       BY P.CAMPAIGN_NO DESC
	</select>

	
	
	<!-- 상세조회 -->
	<select id="selectByCampaignNo" resultType="CampaignDTO">
	    <include refid="campaignColumn"/>
	    WHERE 
	          A.FILE_LEVEL = 1
	      AND 
	          P.STATUS = 'Y'
	      AND 
	          P.END_DATE >= SYSDATE
	      AND 
	          P.CAMPAIGN_NO = #{campaignNo}
	    ORDER 
	       BY P.CAMPAIGN_NO DESC
	</select>

	
	
</mapper>